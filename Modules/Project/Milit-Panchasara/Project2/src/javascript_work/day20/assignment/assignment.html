<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../css/bootstrap.css">
    <link rel="stylesheet" href="../../../css/style.css">
    <title>JS practice</title>
</head>

<body onload="getItemsFromFile()">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <div class="container">
            <a href="" class="navbar-brand">
                <img src="../../../img/logo.jpg" alt="" class="img-fluid" height="100px" width="100px" style="box-shadow: 0 0 20px #fff;">
            </a>
            <button class=" navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarnav1"><span
                    class="navbar-toggler-icon"></span></button>
            <div class=" navbar-collapse collapse" id="navbarnav1">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a href="/index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="../../../html_work/index.html" class="nav-link">HTML</a></li>
                    <li class="nav-item"><a href="../../../css_work/index.html" class="nav-link">CSS</a></li>
                    <li class="nav-item"><a href="../../../bootstrap_work/index.html" class="nav-link">Bootstrap</a></li>
                    <li class="nav-item"><a href="../../index.html" class="nav-link">JavaScript</a></li>
                    <li class="nav-item"><a href="../../../mini_project_work/index.html" class="nav-link">Mini Project</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="row" style="margin-top: 89px !important;">
        <div id="side-nav" class="col-12 col-lg-3 bg-secondary m-3 p-3" >
            <ul>
                <li>
                    Day 15
                    <ul>
                        <li>
                            Assignment
                            <ul>
                                <li><a href="../../day15/assignment.html">Assignment 1</a></li>
                            </ul>
                        </li>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day15/practice1.html">Practice 1</a></li>
                                <li><a href="../../day15/practice2.html">Practice 2</a></li>
                                <li><a href="../../day15/practice3.html">Practice Extra 1</a></li>
                                <li><a href="../../day15/multiplebutton.html">Practice Extra 2</a></li>
                                <li><a href="../../day15/multiplespan.html">Practice Extra 3</a></li>
                                <li><a href="../../day15/numeric1.html">Practice Extra 4</a></li>
                                <li><a href="../../day15/numeric2.html">Practice Extra 5</a></li>
                                <li><a href="../../day15/singlespan.html">Practice Extra 6</a></li>
                                <li><a href="../../day15/submitfrombutton.html">Practice Extra 7</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Day 16
                    <ul>
                        <li>
                            Assignment
                            <ul>
                                <li><a href="../../day16/assignment.html">Assignment 1</a></li>
                            </ul>
                        </li>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day16/practice1.html">Practice 1-5</a></li>
                                <li><a href="../../day16/practice2.html">Practice Extra</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Day 17
                    <ul>
                        <li>
                            Assignment
                            <ul>
                                <li><a href="../../day17/assignment.html">Assignment 1</a></li>
                            </ul>
                        </li>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day17/practice1.html">Practice 7,9</a></li>
                                <li><a href="../../day17/practice2.html">Practice 8</a></li>
                                <li><a href="../../day17/event-listeners-practice.html">Practice Extra</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Day 18
                    <ul>
                        <li>
                            Assignment
                            <ul>
                                <li><a href="../../day18/assignment/assignment.html">Assignment 1</a></li>
                            </ul>
                        </li>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day18/practice1.html">Practice 1</a></li>
                                <li><a href="../../day18/practice2.html">Practice 2</a></li>
                                <li><a href="../../day18/practice3.html">Practice 3</a></li>
                                <li><a href="../../day18/extra.html">Practice Extra</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Day 19
                    <ul>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day19/practice1.html">Practice 1</a></li>
                                <li><a href="../../day19/practice2.html">Practice 2</a></li>
                                <li><a href="../../day19/practice3.html">Practice 3</a></li>
                                <li><a href="../../day19/practice4.html">Practice 4</a></li>
                                <li><a href="../../day19/practice4.html">Practice 5</a></li>
                                <li><a href="../../day19/practice6.html">Practice 6</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Day 20
                    <ul>
                        <li>
                            Assignment
                            <ul>
                                <li><a href="../../day20/assignment/assignment.html">Assignment 1</a></li>
                            </ul>
                        </li>
                        <li>
                            Practice
                            <ul>
                                <li><a href="../../day20/practice1_setData.html">Practice 1 (set data)</a></li>
                                <li><a href="../../day20/practice1_getData.html">Practice 1 (get data)</a></li>
                                <li><a href="../../day20/geolocation.html">Practice Extra 1</a></li>
                                <li><a href="../../day20/fetch using aync-await.html">Practice Extra 2 (async-await)</a></li>
                                <li><a href="../../day20/fetch using promise.html">Practice Extra 3 (promises)</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div id="body-content" class="offset-lg-3 col-12 col-lg-9 my-5">
        <div class="conatiner m-3"> 
            <table class="table table-bordered table-hover text-center">
                <tr class="bg-dark text-light">
                    <th>Sr. No.</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity (upto 25)</th>
                    <th>Action</th>
                    <th>Total Prices</th>
                </tr>
                <tbody id="items-table-body">

                </tbody>
            </table>
            <button class="btn btn-primary" onclick="viewCartSummary()"  data-toggle="modal" data-target="#cart-modal" id="view-cart-btn">View Cart Summary</button>
            <button class="btn btn-danger"  onclick="resetCartSummary()">Reset Cart</button>
            <hr>
            <div id="cartSummary">
            
            </div>
        </div>
    </div>
    <script src="../../../js/jquery.min.js"></script>
    <script src="../../../js/popper.min.js"></script>
    <script src="../../../js/bootstrap.min.js"></script>
    <!-- CART MODAL -->
    <div class="modal fade text-dark" id="cart-modal" tabindex="1">
        <div class="modal-dialog">
            <div class=" modal-content">
                <div class="modal-header">
                    <h4 class=" modal-title">Cart</h4>
                    <button type="button" data-dismiss="modal" class="close">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">

                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-block" id="checkout-btn">Checkout</button>
                </div>

            </div>
        </div>
    </div>

    <script>      
    var data;
    async function getItemsFromFile() {
        var file = await fetch('data.json');
        data = await file.text();
        
        data = JSON.parse(data);

        var tableBody = document.getElementById('items-table-body');

        for(var i=1; i <= data.products.length; i++)
        {
            tableBody.innerHTML += '<tr id="row-'+(i-1)+'">\
                <td>'+i+'</td>\
                <td>'+data.products[i-1].Name+'</td>\
                <td id="price-'+(i-1)+'">'+data.products[i-1].Price+'</td>\
                <td><input class="form-control w-25 text-center mx-auto" type="text" id="quantity-'+(i-1)+'" onkeyup="calculateTotal('+(i-1)+')"></td>\
                <td><button class="btn btn-outline-info" onclick="addItemToCart('+(i-1)+')" id="add-btn-'+(i-1)+'">Add to Cart</button></td>\
                <td id="total-'+(i-1)+'"></td>'
        }

        if(typeof(Storage) !== "undefined") {
            if(localStorage.cartItems){
                console.log(localStorage.cartItems);
                let itemsData = localStorage.cartItems;
                itemsData = itemsData.split("|");
                itemsData.forEach(item => {
                    item = JSON.parse(item);
                    var itemNumber = item.productIndex;
                    document.getElementById('total-'+itemNumber).innerHTML = parseFloat(item.quantity)*parseFloat(data.products[itemNumber].Price);
                    document.getElementById('quantity-'+itemNumber).value = item.quantity;
                    document.getElementById('add-btn-'+itemNumber).disabled = true;
                });
            }
        }

    }

    function addItemToCart(item) {
        var quantityId = "quantity-"+item;
        var quantity = parseFloat(document.getElementById(quantityId).value);
        if(isNaN(quantity) || quantity > 25 || quantity < 1) {
            alert("Please enter the quantity between 1 and 25");
            return;
        }

        let itemData = {
            "productIndex": item,
            "quantity" : quantity
        }

        if(typeof(Storage) !== "undefined") {
            if(!localStorage.cartItems) {
                localStorage.setItem('cartItems', JSON.stringify(itemData));
            }
            else {
                localStorage.cartItems += "|" + JSON.stringify(itemData);
            }
            document.getElementById('add-btn-'+item).disabled = true;
        }
        else {
            alert("Storage is not supported!");
            return;
        }
    }

    function viewCartSummary() {
        if(typeof(Storage) !== "undefined") {
            if(localStorage.cartItems){
                console.log(localStorage.cartItems);
                document.getElementById('modal-body').innerHTML = '<ul id="items-list"></ul>';
                var grandTotal = 0;
                let itemsData = localStorage.cartItems;
                itemsData = itemsData.split("|");
                itemsData.forEach(item => {
                    item = JSON.parse(item);
                    document.getElementById('items-list').innerHTML+=
                        '<li>Product: '+ data.products[item.productIndex].Name + 
                        ',<br>Quantity: ' + item.quantity + 
                        ',<br>Total price: ' + (parseFloat(item.quantity) * parseFloat(data.products[item.productIndex].Price)) +
                        '</li><hr>';
                    grandTotal += (parseFloat(item.quantity) * parseFloat(data.products[item.productIndex].Price));
                });

                document.getElementById('modal-body').innerHTML += '<h4>Grand Total: '+ grandTotal + '</h4>';
            }
            else {
                document.getElementById('modal-body').innerHTML = '<ul id="items-list"></ul><h4>Cart is empty</h4>';
                document.getElementById('checkout-btn').disabled = true;
            }
            
        }
    }

    function resetCartSummary() {
        if(typeof(Storage) !== "undefined") {
            localStorage.removeItem('cartItems');
            if(document.getElementById('items-list')){
                document.getElementById('items-list').innerHTML = "";
            }
            for(var i=0; i < data.products.length; i++)
            {
                document.getElementById('total-'+i).innerHTML = "";
                document.getElementById('quantity-'+i).value = null;
                document.getElementById('add-btn-'+i).disabled = false;
            }

            alert("Your cart is reset!")
        }
    }

    function calculateTotal(item) {
        var totalId = "total-"+item;
        var total = document.getElementById(totalId);

        var quantityId = "quantity-"+item;
        var quantity = parseFloat(document.getElementById(quantityId).value);
        if(isNaN(quantity) || quantity > 25 || quantity < 1) {
             total.innerHTML = ""
            return;
        }
        
        var priceId = "price-"+item;
        var price = document.getElementById(priceId).innerHTML;

        total.innerHTML = parseFloat(quantity) * parseFloat(price);
    }
    </script>

</body>
</html>