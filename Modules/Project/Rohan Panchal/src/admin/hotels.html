
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hotels | Admin</title>

   
    <script src="../js/jquery.min.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

  <!-- datatable css -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">

  <!-- Font icon css -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- sweet alert js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
  
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="../css/dashboard.css" rel="stylesheet">
  </head>
  <body>
    
    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
      <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 text-center" href="#"><img src="../img/logo@2x.png" style="height: 35px;" alt=""></a>
      <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="#">Sign out</a>
        </li>
      </ul>
    </header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="dashboard.html">
              <i class="fa fa-tachometer" aria-hidden="true"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="state.html">
              <i class="fa fa-globe" aria-hidden="true"></i>
                state
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="city.html">
              <i class="fa fa-map-marker" aria-hidden="true"></i>
                City
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="services.html">
              <i class="fa fa-cogs" aria-hidden="true"></i>
                Our Services
            </a>
          </li>
           <li class="nav-item dropend">
            <a class="nav-link dropdown-toggle" data-bs-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1"><i class="fa fa-check-square-o" aria-hidden="true"></i> Facilites</a>
        
            <ul class="collapse multi-collapse mx-1 list-unstyled" id="multiCollapseExample1" style="background-color: rgb(204, 204, 204);">
                <a class="nav-link" href="facilityCategory.html"><i class="fa fa-chevron-right" aria-hidden="true"></i> Category</a>
                <a class="nav-link" href="facilitySubCategory.html"> <i class="fa fa-chevron-right" aria-hidden="true"></i> Sub Category</a>
            </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="hotels.html">
                <i class="fa fa-building-o" aria-hidden="true"></i>
                  Hotels
              </a>
            </li>
        </ul>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Hotels</h1>
        <button class="btn btn-outline-primary" type="button" onclick="openModal()"><i class="fa fa-plus-square" aria-hidden="true"></i> Add</button>
        <!-- Modal -->
        <div class="modal fade" id="hotelModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Enter Facility Sub Category</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="myForm">
                   <div class="row">
                       <div class="col-6">
                        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner" id="loadImages">
                               
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </a>
                        </div>
                       </div>
                       
                        <div class="col-6">
                            
                            <div class="form-group my-4">
                                <label for="files">Images</label>
                                <input type="file" name="files[]" id="files" multiple class="form-control" oninput="myFunction()">
                            </div>
                            
                            <div class="form-group my-4">
                                <label for="hotelName">Hotel Name</label>
                                <input type="text" id="hotelName" class="form-control">
                            </div>
                            
                            <div class="form-group my-4">
                              <label for="statecity">Select City</label>
                              <select id="statecity" class="form-control">

                              </select>
                            </div>

                            <div class="form-group my-4">
                              <label for="address">Address</label>
                              <input class="form-control" type="text" id="address">
                            </div>
                        </div>
                      </row>
                        <div class="row">
                          <div class="col">
                            <div class="form-group my-2">
                              <label for="description">Description</label>
                              <input class="form-control" type="text" id="description">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <div class="h4 text-muted">Add Sub Description</div>
                            <button class="btn btn-primary text-nowrap" type="button" onclick="addrow()">Add Row</button>
                          </div>
                        </div>
                        <div class="row">
                           <div id="multipleInputs">
                            
                          </div>  
                        </div>
                        <div class="row mt-3">
                          <div class="col-6">
                            <div class="h5 text-muted">Select Facilites</div>
                            
                            <div class="form-group">
                              <label for="fCategory">Add the Facility</label>
                              <hr>
                              <select id="fCategory" class="form-control" multiple style="height: 400px;" onchange="loadSubCategory(this.value)">
                              
                              </select>
                              
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="h5 text-muted">Selected Facilites</div>
                            <hr>
                            <div class="form-group">
                              <label for="fSubCategory">Remove the Facility</label>
                              <select id="fSubCategory" class="form-control" multiple style="height: 400px;">
                                
                              </select>
                            
                            </div>
                          </div>
                           
                        </div>
                        
                        
                </div>
            </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                  <button type="button" id="saveButton" class="btn btn-success" onclick="save()">Save changes</button>
                  <!-- <button type="button" id="updateButton" class="btn btn-success d-none" onclick="update()">Update changes</button> -->
                </div>
              </div>
            </div>
          </div>
      </div>
      <div class="container-fluid">
        <table id="myTable" class="table table-hover table-bordered display">
          <thead>
              <tr>
                  <th>Images</th>
                  <th>Hotel Name</th>
                  <th>Address</th>
                  <th>Action</th>
              </tr>
          </thead>
          <tbody id="myTableBody" class="text-break">
  
          </tbody>
      </table>
      </div>
    </main>
  </div>
</div>
<script>
var dataTable;
  document.getElementById('fCategory').innerHTML="";

$(document).ready(function()
{
  dataTable = $('#myTable').DataTable({
        "lengthMenu":  [5,10,15,20,25,30],
    });

    datas();



    getcity = JSON.parse(localStorage.getItem('cities'));
    getstate = JSON.parse(localStorage.getItem('states'));
    var optgroup="<option value=''>Select a City</option>";

    for(obj in getstate)
    {
      var state = getstate[obj];
      optgroup += "<optgroup label='"+state+"'>";
        for(obj2 in getcity)
        {
            if(getcity[obj2].stateName === state)
            {
                optgroup+="<option value='"+JSON.stringify(getcity[obj2])+"'>"+getcity[obj2].cityName+"</option>";
            }
        }
        optgroup+="</optgroup>";
    }
    document.getElementById('statecity').innerHTML=optgroup;
    // Load Categories in select
    var getCategory = JSON.parse(localStorage.getItem('facility_Category'));
    var getSubCategory = JSON.parse(localStorage.getItem('facility_Sub_Category'));
    var row = "";
    for(obj in getCategory)
    {
      row += "<optgroup label='"+getCategory[obj].fCategoryName+"''>";
      for(subObj in getSubCategory)
      {
        //console.log(JSON.parse(getSubCategory[subObj].fCategoryObj).fCategoryName+" = "+getCategory[obj].fCategoryName);
        if(JSON.parse(getSubCategory[subObj].fCategoryObj).fCategoryName === getCategory[obj].fCategoryName)
        {
          //console.log(getSubCategory[subObj]);
          row += "<option value='"+JSON.stringify(getSubCategory[subObj])+"'>"+getSubCategory[subObj].fSubCategoryName+"</option>";
        }
      }
      row += "</optgroup>";
    }
    document.getElementById('fCategory').innerHTML=row;
});

function datas()
{
  var Data = JSON.parse(localStorage.getItem('hotels')) || [];
   
  var row=[];
  for(obj in Data)
  {
      console.log(JSON.parse(Data[obj]));
      row[obj]='<div id="'+JSON.parse(Data[obj]).hotelName+'" class="carousel slide" data-bs-ride="carousel">'+
      '<div class="carousel-inner" id="loadImages">';

    for(let i=0;i<JSON.parse(Data[obj]).hotelImage.length;i++)
    {
      if(i==0)
      {
        row[obj]+= '<div class="carousel-item active">'+
                            '<img src="../img/hotels/'+JSON.parse(Data[obj]).hotelImage[i]+'" class="d-block w-100" alt="...">'+
                            '</div>';
      }
      else
      {
        row[obj]+='<div class="carousel-item">'+
                            '<img src="../img/hotels/'+JSON.parse(Data[obj]).hotelImage[i]+'" class="d-block w-100" alt="...">'+
                            '</div>';
      }
    }
    row[obj]+='<a class="carousel-control-prev" href="#'+JSON.parse(Data[obj]).hotelName+'" role="button" data-bs-slide="prev">'+
      '<span class="carousel-control-prev-icon" aria-hidden="true"></span>'+
      '<span class="visually-hidden">Previous</span>'+
      '</a>'+
      '<a class="carousel-control-next" href="#'+JSON.parse(Data[obj]).hotelName+'" role="button" data-bs-slide="next">'+
      '<span class="carousel-control-next-icon" aria-hidden="true"></span>'+
      '<span class="visually-hidden">Next</span>'+
      '</a></div></div>';
  }
   
    

    if(parseInt(Data.length) == 0)
    {
        dataTable.draw(false);
    }
    else
    {
        for(obj in Data)
        {
            dataTable.row.add([
            row[obj],
            JSON.parse(Data[obj]).hotelName,
            JSON.parse(Data[obj]).address+","+JSON.parse(JSON.stringify(JSON.parse(Data[obj]).statecity)).cityName+","+JSON.parse(JSON.stringify(JSON.parse(Data[obj]).statecity)).stateName,
            '<a href="javascript:void(0)" onclick="deleteData('+obj+')"><i class="fa fa-trash-o text-danger fa-2x" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;'+
            '<a href="javascript:void(0)" onclick="updateData('+obj+')"><i class="fa fa-pencil text-success fa-2x" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;'+
            '<a href="javascript:void(0)" onclick="roomData('+obj+')"><i class="fa fa-bed text-primary fa-2x" aria-hidden="true"></i></a>',
            ]).draw(false);
        }
    }
}
function updateData(val)
{
  alert(val);
}
function roomData(val)
{
  window.location.href = "rooms.html?hotel="+val;
}

// add the data 
var subcategoryArray=[];
function loadSubCategory(val)
{
  document.getElementById("fSubCategory").innerHTML = " ";
  $('#fSubCategory').empty();
  if(subcategoryArray.length<=0)
  {
    subcategoryArray.push(JSON.parse(val));
  }
  else
  {
    var check = true;
      for(obj in subcategoryArray)
      {
        if(subcategoryArray[obj].fSubCategoryName == JSON.parse(val).fSubCategoryName)
        {
          check=false;
          break;
        }
      }
      if(check==true)
      {
        subcategoryArray.push(JSON.parse(val));
      }
  }
  //console.log(subcategoryArray);
  loadvSubCategoryArray();
}
// load selected data into the this array to insert the data
var selectedData = {};
function loadvSubCategoryArray()
{

  var getCategory = JSON.parse(localStorage.getItem('facility_Category'));
  for(obj in getCategory)
  {
    var arr = [];
    for(obj2 in subcategoryArray)
    {
      if(getCategory[obj].fCategoryName === JSON.parse(subcategoryArray[obj2].fCategoryObj).fCategoryName)
      {
        arr.push(subcategoryArray[obj2].fSubCategoryName);
        selectedData[getCategory[obj].fCategoryName]=arr;
      }
    }
    
  }
  displayinselect();
}
// this data shows into selected Facilities
function displayinselect()
{
  var row="";
  for(obj in selectedData)
  {
    //document.getElementById("fSubCategory").innerHTML="";
    row+="<optgroup label='"+obj+"'>";
    //console.log(selectedData);
    for(obj2 in selectedData[obj])
    {
      
      row+="<option value='' onclick='removes("+JSON.stringify(selectedData[obj][obj2])+")'>"+selectedData[obj][obj2]+"</option>";
      //console.log(row);
      //i++;
    }
    row+="</optgroup>";
  }
  document.getElementById("fSubCategory").innerHTML=row;
}
// it removes the subcategory from the array
function removes(subCatIndex)
{
  console.log("before = "+JSON.stringify(subcategoryArray));
 for(obj in subcategoryArray)
  {
    //console.log("subcats = "+subcategoryArray);
    if(subcategoryArray[obj].fSubCategoryName === subCatIndex)
    { 
      var onedata = JSON.stringify(subcategoryArray[obj]);
      console.log("obj ="+onedata);

        subcategoryArray.splice(obj,1);
        
    
        
    }
    //console.log(subcategoryArray[obj],obj);
  }
  console.log("after = "+JSON.stringify(subcategoryArray));
  loadvSubCategoryArray();
}
function openModal()
{
    $('#hotelModal').modal('show');   
    document.getElementById('myForm').reset();
    
    subcategoryArray=[];
    document.getElementById('fSubCategory').innerHTML="";
}

function save()
{
    var filee = document.getElementById('files').files;
    var hotelName = document.getElementById('hotelName').value;
    var statecity = document.getElementById('statecity').value;
    var address = document.getElementById('address').value;
    var description = document.getElementById('description').value;
    var subdesciptions = document.getElementsByName('addrow[]');
    var facilities = selectedData;
    var subdesciptionslist=[];
    for(i=0;i<subdesciptions.length;i++)
    {
      subdesciptionslist.push(subdesciptions[i].value);
    }
    //console.log(filee.length);
    var images = [];
    for(let i=0;i<filee.length;i++)
    {
        //console.log(filee[i].name);
        images.push(filee[i].name);
    }   
    var hotels = JSON.parse(localStorage.getItem('hotels')) || [];
    var data = {'hotelImage':images,'hotelName':hotelName,'statecity':JSON.parse(statecity),'address':address,'description':description,'subdesciptions':subdesciptionslist,'facilities':facilities};
    hotels.push(JSON.stringify(data));
    localStorage.setItem('hotels',JSON.stringify(hotels));
    $('#hotelModal').modal('hide');
    dataTable.clear();
    datas();
}
function deleteData(val)
{
  swal({
        title: 'Are you sure?',
        text: "It will permanently deleted !",
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonClass: "btn-danger",
        confirmButtonText: "Yes, delete it!",
        cancelButtonText: "No, cancel plx!",
        closeOnConfirm: false,
        closeOnCancel: false,
    },function(isConfirm) {
        if(isConfirm)
        {
            swal("Deleted!", "Your imaginary file has been deleted.", "success"); 
            var getdata = JSON.parse(localStorage.getItem('hotels'));
            getdata.splice(val,1);
            localStorage.setItem('hotels',JSON.stringify(getdata));
            dataTable.clear();
            datas();                 
            }
        else
        {
            swal("Cancelled", "Your Data is safe :)", "error");
        }
    })
}




// load images onupload()
function myFunction()
{

    var filee = document.getElementById('files').files;
    var  row='<div class="carousel-item active">'+
                            '<img src="../img/hotels/'+filee[0].name+'" class="d-block w-100" alt="...">'+
                            '</div>';
    for(let i=1;i<filee.length;i++)
    {
        row+='<div class="carousel-item">'+
                            '<img src="../img/hotels/'+filee[i].name+'" class="d-block w-100" alt="...">'+
                            '</div>';
                            //console.log(filee[i].name);
    }
    document.getElementById('loadImages').innerHTML=row;
}
var array = [];
function addrow()
{
     var row =  "<div class='row my-2 text-wrap'>"+
                    "<div class='col-10'>"+
                        "<input type='text' class='form-control' name='addrow[]'/>"+
                    "</div>"+
                    "<div class='col-2'>"+
                        "<button type='button' class='btn btn-primary' onclick='removerow("+(array.length)+")'>remove</button>"+
                    "</div>"+
                "</div>";
    array.push(row);
    display();
}
function display()
{
    document.getElementById('multipleInputs').innerHTML="";
    for(obj in array)
    {
        document.getElementById('multipleInputs').innerHTML+=array[obj];
    }
}
function removerow(i)
{
    if(i==0)
    {
        array.pop();
    }
    else{
        array.splice(i,1);
    }
    document.getElementById('multipleInputs').innerHTML="";
    display();
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
<!-- datatable js -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
<!-- sweetAlert JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
      <!-- <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script><script src="dashboard.js"></script> -->
  </body>
</html>
